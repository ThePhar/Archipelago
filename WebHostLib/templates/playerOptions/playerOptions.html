{% extends "pageWrapper.html" %}
{% import "playerOptions/macros.html" as inputs with context %}

{% block head %}
    <title>{{ world_name }} Options</title>
    <link
        rel="stylesheet"
        type="text/css"
        href="{{ url_for("static", filename="styles/options/player.css") }}"
    >
    <script defer type="application/ecmascript" src="{{ url_for("static", filename="assets/options/shared.js") }}"></script>
    <script defer type="application/ecmascript" src="{{ url_for("static", filename="assets/options/player.js") }}"></script>

    <noscript>
        <style>
            .js-required {
                display: none !important;
            }
        </style>
    </noscript>
{% endblock %}

{% macro PlayerNameHelp() %}
    <p>
        Also known as your &ldquo;slot name&rdquo;, this is the name you use to connect with your game. Names larger
        than 16 characters will be trimmed by the generator.
    </p>
    <p>
        You can also include the following keywords surrounded by curly braces and the generator will replace it:
    </p>
    <ul>
        <li><code>{player}</code> is replaced with your slot number.</li>
        <li><code>{PLAYER}</code> is replaced with your slot number, if greater than 1.</li>
        <li><code>{number}</code> is replaced with <em>n-th</em> instance of your name.</li>
        <li><code>{NUMBER}</code> is replaced with <em>n-th</em> instance of your name, if greater than 1.</li>
    </ul>
{% endmacro %}

{% block body %}
    {% include header_theme %}
    <div id="player-options" class="markdown" data-game="{{ world_name }}">
{#        <noscript>#}
{#            <div class="alert">#}
{#                This page has reduced functionality without JavaScript.#}
{#            </div>#}
{#        </noscript>#}

        {# Used for JS alerts and Flask flash messages. #}
{#        <div id="user-message" class="alert">{{ message }}</div>#}

        <div id="options-header">
            <h1>{{ world_name }}</h1>
            <h2>Player Options</h2>
            <p>
                Choose the options you would like to play with! You may generate a single-player game from this page, or
                download an options file you can use to participate in a MultiWorld.
            </p>

            <ul>
                <li>A more advanced options configuration for all games can be found on the <a href="weighted-options">Weighted
                    options</a> page.
                </li>
                <li>A list of all games you have generated can be found on the <a href="/user-content">User Content
                    Page</a>.
                </li>
                <li>You may also download the <a href="/static/generated/configs/{{ world_name }}.yaml">template file
                    for this game</a>.
                </li>
            </ul>
        </div>

        <form id="options-form" method="post" enctype="application/x-www-form-urlencoded" action="generate-yaml">
            <div id="options-meta">
                <div class="option-container">
                    <label for="player-name">
                        Player Name:
                        <span class="interactive tooltip-container">
                            (?)<span class="tooltip">{{ PlayerNameHelp() | safe }}</span>
                        </span>
                    </label>
                    <div class="option-inputs">
                        <input id="player-name" placeholder="Player" name="name" required>
                    </div>
                </div>
                <div class="js-required option-container">
                    <label for="game-options-preset">
                        Options Preset:
                        <span
                            class="interactive tooltip-container"
                            data-tooltip="Select from a list of developer-curated presets (if any) or reset all options to their defaults."
                        >
                            (?)
                        </span>
                    </label>
                    <div class="option-inputs">
                        <select id="game-options-preset" name="game-options-preset">
                            <option value="default">Default</option>
                            {% for preset_name in world.web.options_presets %}
                                <option value="{{ preset_name }}">{{ preset_name }}</option>
                            {% endfor %}
                            <option value="custom" hidden>Custom</option>
                        </select>
                    </div>
                </div>
            </div>

            <div id="option-groups">
                {% for group_name, group_options in option_groups.items() %}
                    <details class="group-container" {% if not start_collapsed[group_name] %}open{% endif %}>
                        <summary><h3>{{ group_name }}</h3></summary>
                        <div class="options">
                            {% for option_name, option in group_options.items() %}
                                {% if issubclass(option, Options.Toggle) %}
                                    {{ inputs.Toggle(option_name, option) }}

                                {% elif issubclass(option, Options.TextChoice) %}
                                    {{ inputs.TextChoice(option_name, option) }}

                                {% elif issubclass(option, Options.Choice) %}
                                    {{ inputs.Choice(option_name, option) }}

                                {% elif issubclass(option, Options.NamedRange) %}
                                    {{ inputs.NamedRange(option_name, option) }}

                                {% elif issubclass(option, Options.Range) %}
                                    {{ inputs.Range(option_name, option) }}

                                {% elif issubclass(option, Options.FreeText) %}
                                    {{ inputs.FreeText(option_name, option) }}

                                {% elif issubclass(option, Options.ItemDict) and option.verify_item_name %}
                                    {{ inputs.ItemDict(option_name, option) }}

                                {% elif issubclass(option, Options.OptionList) and option.valid_keys %}
                                    {{ inputs.OptionList(option_name, option) }}

                                {% elif issubclass(option, Options.LocationSet) and option.verify_location_name %}
                                    {{ inputs.LocationSet(option_name, option) }}

                                {% elif issubclass(option, Options.ItemSet) and option.verify_item_name %}
                                    {{ inputs.ItemSet(option_name, option) }}

                                {% elif issubclass(option, Options.OptionSet) and option.valid_keys %}
                                    {{ inputs.OptionSet(option_name, option) }}
                                {% endif %}
                            {% endfor %}
                        </div>
                    </details>
                {% endfor %}
            </div>

            <div id="options-button-row">
                <input type="submit" name="intent-export" value="Download Options">
                <input type="submit" name="intent-generate" value="Generate Single-Player Game">
            </div>
        </form>
    </div>
{% endblock %}
